@{
    ViewData["Title"] = "Heggis";
}
@using Adrians.Services
@using Adrians.ViewModels
@{
    var varsel = ViewData["Korttidsvarsel"] as KorttidsvarselViewModel;
    var snow = ViewData["Snow48"] as FrostSnowSummary;
}


<div class="container-fluid px-0">
    <div class="row g-4 align-items-start">
        
        
        @if (snow is not null)
        {
            <div class="card border-0 shadow-sm bg-body-tertiary mb-4">
                <div class="card-body d-flex justify-content-between align-items-start">
                    <div>
                        <div class="fw-semibold">Snø / nedbør – @snow.LocationName</div>
                        <div class="text-body-secondary small">@snow.SourceId</div>

                        <div class="mt-2">
                            <div>Snødybde no: <strong>@(snow.SnowDepthNowCm?.ToString("0.#") ?? "—") cm</strong></div>
                            <div>Endring 48t: <strong>@(snow.SnowDepthDelta48hCm?.ToString("0.#") ?? "—") cm</strong></div>
                            <div>Nedbør 24t: <strong>@snow.PrecipLast24hMm.ToString("0.#") mm</strong></div>
                            <div>Nedbør 48t: <strong>@snow.PrecipLast48hMm.ToString("0.#") mm</strong></div>
                        </div>
                    </div>
                    <span class="badge text-bg-secondary">Frost</span>
                </div>
            </div>
        }

        <!-- Korttidsvarsel lokasjon -->
        <partial name="_KorttidsvarselCard" model="varsel" />

        <!-- Parkering webcam (JPEG som oppdaterer seg) -->
        <div class="col-12 col-lg-6">
            <div class="card border-0 shadow-sm bg-body-tertiary">
                <div class="card-header bg-transparent border-0 pb-0">
                    <h5 class="card-title mb-0">Parkering – webkamera</h5>
                    <small class="text-body-secondary">Oppdaterer ca. kvart minutt</small>
                </div>

                <div class="card-body pt-3">
                    <img id="heggis-cam"
                         class="img-fluid rounded d-block w-100 bg-black"
                         src="https://sognskisenter.org/webkam/parkering/image.jpg"
                         alt="Webkamera – Heggmyrane (parkering)"
                         loading="lazy"/>
                </div>
            </div>
        </div>

        <!-- Løyper.net -->
        <div class="col-12 col-lg-6">
            <div class="card border-0 shadow-sm bg-body-tertiary">
                <div class="card-header bg-transparent border-0 pb-0">
                    <h5 class="card-title mb-0">Løyper</h5>
                    <small class="text-body-secondary">Kart og status</small>
                </div>

                <div class="card-body pt-3">
                    <div class="rounded overflow-hidden" style="height: 700px;">
                        <iframe class="w-100 h-100 border-0"
                                src="https://www.loyper.net/location/sognskisenter?lat=61.335538222693714&lng=7.21928243332502&zoom=14.757321853632988"
                                loading="lazy"
                                allowfullscreen>
                        </iframe>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script>
        (function () {
            const img = document.getElementById("heggis-cam");
            if (!img) return;

            const baseUrl = "https://sognskisenter.org/webkam/parkering/image.jpg";

            function refresh() {
                img.src = baseUrl + "?t=" + Date.now(); // cache-buster
            }

            setInterval(refresh, 60_000);
        })();
    </script>
}
