@{
    ViewData["Title"] = "Time Capsule";
}

<section class="timecapsule-section py-5 fade-in">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title text-center mb-0">Time Capsule Challenge</h2>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <form id="guessForm" class="mb-4">
                                <div class="mb-3">
                                    <label for="guess" class="form-label fw-bold">Guess the Year:</label>
                                    <input type="number" id="guess" name="guess" class="form-control form-control-lg text-center"
                                           style="max-width: 200px; margin: 0 auto;" required
                                           aria-describedby="guessHelp" min="1800" max="2050">
                                    <div id="guessHelp" class="form-text">Enter a year between 1800 and 2050</div>
                                </div>
                                <button type="submit" id="submit" class="btn btn-primary btn-lg me-2" aria-label="Submit your year guess">
                                    <i class="fas fa-paper-plane me-2" aria-hidden="true"></i>Submit Guess
                                </button>
                                <button id="hint" class="btn btn-outline-secondary btn-lg" aria-label="Get a hint for the year range">
                                    <i class="fas fa-lightbulb me-2" aria-hidden="true"></i>Hint
                                </button>
                            </form>

                            <div id="message" class="alert mb-3 d-none" role="alert" aria-live="polite"></div>

                            <div id="score" class="mb-3">
                                <span class="badge bg-info fs-5 px-3 py-2">
                                    <i class="fas fa-trophy me-2" aria-hidden="true"></i>
                                    Score: <span id="score-value" aria-label="Current score">0</span>
                                </span>
                            </div>
                        </div>

                        <div class="image-container text-center">
                            <div class="ratio ratio-16x9 mb-3" style="max-width: 600px; margin: 0 auto;">
                                <img id="image" src="" alt="Historical image for year guessing game" class="img-fluid rounded shadow">
                            </div>
                            <p class="text-muted small">Guess when this photo was taken!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<script>
	// Define an array of objects that contain the image URL and the year the photo was taken
	const images = [
		{ url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Sogndal_JarleN.JPG/800px-Sogndal_JarleN.JPG?20100502192343', year: 2010 },
		{ url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Leikanger_hermansverk.jpg/800px-Leikanger_hermansverk.jpg?20061215023057', year: 2005 },
		{ url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/Erling_Haaland_2023_%28cropped%29.jpg/800px-Erling_Haaland_2023_%28cropped%29.jpg', year: 2023 },
		{ url: 'https://2.bp.blogspot.com/-r5X17_WNwVU/WPBQIP9S5vI/AAAAAAAAz9s/xz6XjFuTad00UPv98PlKKBb14uLRwtzMACLcB/s1600/Moscow%2Bin%2B1935%2B%25281%2529.jpg', year: 1935 },
		{ url: 'https://rarehistoricalphotos.com/wp-content/uploads/2023/04/Laika-dog-in-space-small.jpg', year: 1957 }
	];

	// Get the necessary elements from the DOM
	const imageEl = document.getElementById('image');
	const formEl = document.querySelector('form');
	const guessEl = document.getElementById('guess');
	const messageEl = document.getElementById('message');
	const scoreEl = document.getElementById('score-value');
	const hintEl = document.getElementById('hint');

	// Initialize the game
	let score = 0;
	let currentImage = null;

	// Function to display a random image from the array
	function displayImage() {
		// Remove the current image from the array
		const index = images.indexOf(currentImage);
		if (index > -1) {
			images.splice(index, 1);
		}
		// Randomly select an object from the updated array
		currentImage = images[Math.floor(Math.random() * images.length)];
		// Display the image in the container div
		imageEl.src = currentImage.url;
	}

	// Function to handle form submission
	function handleSubmit(event) {
		event.preventDefault();
		const guess = parseInt(guessEl.value);
		const messageDiv = document.getElementById('message');

		// Compare the guess with the year value of the selected object
		if (guess === currentImage.year) {
			// If the guess is correct, update the score counter and display a message that the guess is correct
			score += 1;
			scoreEl.textContent = score;
			messageDiv.className = 'alert alert-success';
			messageDiv.textContent = `Correct! The photo was taken in ${currentImage.year}.`;
		} else {
			// If the guess is incorrect, display a message that the guess is incorrect and deduct points from the score counter
			score -= 1;
			scoreEl.textContent = score;
			messageDiv.className = 'alert alert-danger';
			messageDiv.textContent = `Incorrect! The photo was taken in ${currentImage.year}, not ${guess}.`;
		}

		messageDiv.classList.remove('d-none');
		messageDiv.focus(); // Focus for screen readers

		// Reset the form
		formEl.reset();
		// Display the next image
		setTimeout(displayImage, 2000); // Delay to show message
	}

	// Function to handle hint button click
	function handleHint() {
		const messageDiv = document.getElementById('message');
		const hintYear = currentImage.year;
		const range = 10;
		messageDiv.className = 'alert alert-info';
		messageDiv.textContent = `Hint: The year is between ${hintYear - range} and ${hintYear + range}.`;
		messageDiv.classList.remove('d-none');
		messageDiv.focus();
	}

	// Add event listeners
	formEl.addEventListener('submit', handleSubmit);
	hintEl.addEventListener('click', handleHint);

	// Display the first image
	displayImage();

</script>